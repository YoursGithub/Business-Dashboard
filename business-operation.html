<!DOCTYPE html>
<html>
<head>
    <title>Business Operation</title>
    <link href="assets/css/bootstrap.min.css" id="bootstrap-style" rel="stylesheet" type="text/css" />
    <link href="assets/css/icons.min.css" rel="stylesheet" type="text/css" />
    <link href="https://cdnjs.cloudflare.com/ajax/libs/simplebar/5.3.6/simplebar.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600&display=swap" rel="stylesheet">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link href="assets/css/app.min.css" id="app-style" rel="stylesheet" type="text/css" />
    <script src="assets/js/plugin.js"></script>
    <style>
        * {
            box-sizing: border-box;
            font-family: Arial, sans-serif;
        }

        .containers {
            display: flex;
            justify-content: center;
            gap: 8px;
            margin: 20px;
        }

        .table-container {
            padding: 20px;
            overflow-x: auto;
        }

        .vertical-menu {
    position: fixed;
    top: 70px;
    left: 0;
    width: 250px;
    height: 100%;
    z-index: 999;
}

#page-topbar {
    position: fixed;
    top: 0;
    right: 0;
    left: 0;
    z-index: 1000;
}

modal {
    display: none;
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background-color: rgba(0, 0, 0, 0.5);
}

.modal-content {
    position: relative;
    background-color: #fff;
    margin: 5% auto;
    padding: 20px;
    width: 90%;
    max-width: 500px;
    border-radius: 12px;
    box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
}

.modal-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 20px;
    padding-bottom: 10px;
    border-bottom: 1px solid #eee;
}

.modal-title {
    font-size: 20px;
    font-weight: bold;
    margin: 0;
    margin-top: -20px;
}

body {
    margin: 0;
    padding: 0;
    overflow-x: hidden;
}

table {
    margin-top: 30px;
    width: max-content;
    min-width: 100%;
    border-collapse: collapse;
    background: #fff;
}

        th, td {
            border: 1px solid black;
            padding: 12px;
            text-align: left;
            position: relative;
        }

        .add-party-btn {
            background: #4CAF50;
            color: white;
            border: none;
            padding: 8px 16px;
            cursor: pointer;
            border-radius: 4px;
        }

        .checkbox-container {
    display: flex;
    justify-content: center;
    align-items: center;
    gap: 5px;
}

        .checkbox {
            width: 20px;
            height: 20px;
            border-radius: 4px;
            background: #ff4444;
            cursor: pointer;
            transition: background-color 0.3s;
        }

        .checkbox.checked {
            background: #4CAF50;
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            justify-content: center;
            align-items: center;
        }

        .modal-content {
            background: white;
            padding: 20px;
            border-radius: 8px;
            width: 90%;
            max-width: 500px;
        }

        .add-column-btn {
            background: none;
            border: none;
            font-size: 24px;
            cursor: pointer;
            color: #4CAF50;
        }

        input[type="text"] {
            width: 100%;
            padding: 8px;
            margin: 8px 0;
        }

        .modal-buttons {
            display: flex;
            justify-content: flex-end;
            gap: 10px;
            margin-top: 16px;
        }

        .modal-buttons button {
            padding: 8px 16px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }

        .cancel-btn {
            background: #ddd;
        }

        .close {
    font-size: 24px;
    cursor: pointer;
    color: #666;
    width: 30px;
    margin-top: 30px;
    height: 30px;
    display: flex;
    align-items: center;
    justify-content: center;
    border-radius: 50%;
    background: black;
    border: none;
}

.closes {
    font-size: 24px;
    cursor: pointer;
    color: white;
    width: 30px;
    height: 30px;
    display: flex;
    align-items: center;
    justify-content: center;
    border-radius: 50%;
    background: black;
    border: none;
}


.search-container {
    margin: 20px 0;
    text-align: center;
}

.search-input {
    width: 80%;
    padding: 12px;
    border: 1px solid #ddd;
    border-radius: 25px;
    font-size: 16px;
    outline: none;
}

.search-input:focus {
    border-color: #128C7E;
}

.contacts-container {
    max-height: 400px;
    overflow-y: auto;
    margin: 20px 0;
}

.contact-card {
    display: flex;
    align-items: center;
    padding: 10px 15px;
    cursor: pointer;
    border-bottom: 1px solid #f0f0f0;
    transition: background-color 0.2s;
}

.contact-card:hover {
    background-color: #f5f5f5;
}

.avatar {
    width: 40px;
    height: 40px;
    border-radius: 50%;
    background-color: #128C7E;
    color: white;
    display: flex;
    align-items: center;
    justify-content: center;
    margin-right: 15px;
    font-weight: bold;
}

.contact-info {
    flex-grow: 1;
}

.contact-name {
    font-weight: bold;
    margin-bottom: 4px;
}

.contact-role {
    color: #666;
    font-size: 14px;
}

.selected-contacts {
    display: flex;
    flex-wrap: wrap;
    gap: 10px;
    padding: 10px;
    min-height: 45px;
    border-bottom: 1px solid #ddd;
}

.selected-contact {
    display: flex;
    align-items: center;
    background-color: #E8F5E9;
    padding: 5px 10px;
    border-radius: 20px;
    font-size: 14px;
}

.selected-contact .avatar {
    width: 25px;
    height: 25px;
    font-size: 12px;
    margin-right: 8px;
}

.remove-contact {
    margin-left: 8px;
    cursor: pointer;
    color: #666;
    padding: 0 5px;
}

.remove-contact:hover {
    color: #ff4444;
}

.modal-footer {
    display: flex;
    justify-content: flex-end;
    padding-top: 20px;
    border-top: 1px solid #eee;
    margin-top: 20px;
}

.table-cell {
    padding: 10px;
    border: 1px solid black;
    min-width: 200px;
}

.selected-names-display {
    font-size: 14px;
    color: #333;
    line-height: 1.4;
    margin-top: 20px;
    margin-left: 20px;
}

.edit-btn {
    background: none;
    border: none;
    color: #128C7E;
    cursor: pointer;
    font-size: 12px;
    margin-left: 10px;
    padding: 2px 5px;
    border-radius: 3px;
}

.edit-btn:hover {
    background-color: #E8F5E9;
}

.discussion-container {
    display: flex;
    align-items: center;
    justify-content: space-between;
}

        .company-selection {
            display: flex;
            gap: 20px;
            margin: 20px 0;
        }

        .company-column {
            flex: 1;
            background: #1e1e1e;
            padding: 15px;
            border-radius: 8px;
        }

        .company-option {
            padding: 10px;
            margin: 5px 0;
            background: #2c2c2c;
            border-radius: 4px;
            cursor: pointer;
            transition: background-color 0.3s;
        }

        .company-option.selected {
            background: #4CAF50;
        }

        .close {
            position: absolute;
            right: 20px;
            top: 10px;
            color: white;
            font-size: 28px;
            cursor: pointer;
        }

        .add-btn {
            background-color: #4CAF50;
            color: white;
            padding: 10px 30px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            margin-top: 20px;
            width: 100%;
        }

        .add-btn:hover {
            background-color: #45a049;
        }

        .companies-display {
            border: #1a1a1a;
            background: white;
            padding: 10px;
            margin-top: 10px;
            border-radius: 4px;
            display: none;
        }

        .color-sidebar {
            background-color: #2A3042;
        }

        .text-style {
            color: white;
        }

        .sub-agreement-list {
            margin: 20px 0;
            border: 1px solid #404040;
            border-radius: 4px;
        }

        .sub-agreement-item {
            border-bottom: 1px solid #404040;
            color: white;
        }

        .sub-agreement-item:last-child {
            border-bottom: none;
        }

        .sub-agreement-header {
            padding: 15px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            cursor: pointer;
            background-color: #2A3042;
        }

        .sub-agreement-content {
            padding: 0 15px;
            background-color: #1e1e1e;
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.3s ease-out;
        }

        .sub-agreement-content.active {
            padding: 15px;
            max-height: 500px;
        }

        .arrow {
            width: 20px;
            height: 20px;
            transition: transform 0.3s ease;
        }

        .arrow.active {
            transform: rotate(180deg);
        }

        .add-terms-btn {
            background-color: #007bff;
            color: white;
            padding: 8px 16px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            float: right;
            margin-top: 10px;
        }

        .add-terms-btn:hover {
            background-color: #0056b3;
        }

        .terms-form {
            display: flex;
            flex-direction: column;
            gap: 16px;
        }
        .terms-form input, .terms-form textarea {
            width: 100%;
            padding: 8px;
            margin: 8px 0;
            border: 1px solid #404040;
            border-radius: 4px;
            background-color: #1a1a1a;
            color: white;
        }

        .terms-form textarea {
            height: 100px;
            resize: vertical;
        }

        .save-btn {
            background-color: #28a745;
            color: white;
            padding: 8px 8px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            margin-right: 20px;
            width: auto;
        }

        .save-btn:hover {
            background-color: #218838;
        }

        .main-content {
            margin-top: 100px;
        }
        .discussion-cell {
            position: relative;
        }

        .discussion-cell[data-has-companies="true"] .manage-btn {
            display: none;
        }

        .discussion-cell[data-has-companies="true"] .companies-display {
            display: block;
        }

        #vertical-menu-btn {
    display: block;
}
@media screen and (min-width: 769px) {
    #vertical-menu-btn {
        display: none !important;
    }
}

.add-row-btn {
    position: fixed;
    background-color: #128C7E;
    color: white;
    border: none;
    margin-top: -20px;
    display: flex;
    justify-content: flex-end;
    padding: 10px 20px;
    border-radius: 5px;
    margin-left: 20px;
    cursor: pointer;
    font-size: 14px;
    box-shadow: 0 2px 5px rgba(0,0,0,0.2);
    z-index: 1000;
}

.add-row-btn:hover {
    background-color: #0a7567;
}

.sub-agreement-item {
    position: relative;
    transition: all 0.3s ease;
}

.sub-agreement-item.locked {
    opacity: 0.5;
    pointer-events: none;
    filter: blur(2px);
}

.sub-agreement-header {
    display: flex;
    align-items: center;
    gap: 10px;
    cursor: pointer;
    padding: 10px;
    background-color: black;
    border-radius: 4px;
}

/* Add a lock icon for locked items */
.lock-icon {
    width: 16px;
    height: 16px;
    margin-left: 8px;
    display: none;
}

.sub-agreement-item.locked .lock-icon {
    display: inline;
}





.checkmark {
    color: white;
    display: none;
}


.arrow {
    width: 20px;
    height: 20px;
    margin-left: auto;
    transition: transform 0.3s ease;
}

.sub-agreement-content {
    padding: 10px;
    display: none;
}

.sub-agreement-content.active {
    display: block;
}

.arrow.active {
    transform: rotate(180deg);
}
.containers {
    text-align: center;
}

.manage-btn {
    display: inline-block;
    width: 60%;
    margin-left: 50px;
    padding: 10px;
    font-size: 14px;
    border: none;
    background: #4B93FF;
    color: white;
    border-radius: 4px;
    cursor: pointer;
}

@media (min-width: 1400px) {
    .manage-btn {
        margin-left: 70px;
    }
}

@media (min-width: 1800px) {
    .manage-btn {
        margin-left: 100px;
    }
}
.content-cell {
    cursor: pointer;
    padding: 8px;
    max-width: 200px;
    overflow: hidden;
    text-overflow: ellipsis;
    white-space: nowrap;
}

.add-content-btn {
    background-color: #4CAF50;
    color: white;
    border: none;
    padding: 5px 10px;
    border-radius: 4px;
    cursor: pointer;
    margin: 2px;
}

.add-content-btn:hover {
    background-color: #45a049;
}

.modals {
    display: none;
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background-color: rgba(0,0,0,0.4);
    z-index: 1000;
}

.modal-contents {
    background-color: #fefefe;
    margin: 15% auto;
    padding: 20px;
    border: 1px solid #888;
    width: 80%;
    max-width: 500px;
    border-radius: 5px;
}

.closes {
    color: #aaa;
    float: right;
    font-size: 28px;
    font-weight: bold;
    cursor: pointer;
}

.modal-content {
    background-color: #fefefe;
    margin: 15% auto;
    padding: 20px;
    border: 1px solid #888;
    width: 300px;
    border-radius: 5px;
}

.name-input {
    width: 100%;
    padding: 8px;
    margin: 10px 0;
    box-sizing: border-box;
}

.closes:hover {
    color: black;
}

#contentInput {
    width: 100%;
    padding: 8px;
    margin: 10px 0;
    border: 1px solid #ddd;
    border-radius: 4px;
}

#fullContentDisplay {
    margin-top: 20px;
    padding: 10px;
    border: 1px solid #ddd;
    border-radius: 4px;
    white-space: pre-wrap;
}

.upload-btn {
    padding: 8px 15px;
    background-color: #f0f0f0;
    border: 1px solid #ddd;
    border-radius: 4px;
    cursor: pointer;
    font-size: 14px;
    margin-top: 5px;
}

.file-preview {
    padding: 8px 15px;
    background-color: #e0e0e0;
    border: 1px solid #ccc;
    border-radius: 4px;
    cursor: pointer;
    display: none;
    margin-top: 5px;
    text-align: center;
}

.preview-modal {
    display: none;
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background-color: rgba(0, 0, 0, 0.7);
    z-index: 1000;
}

.preview-content {
    position: relative;
    width: 80%;
    max-width: 800px;
    margin: 50px auto;
    background-color: white;
    padding: 20px;
    border-radius: 8px;
}

.close-preview {
    position: absolute;
    right: 10px;
    top: 10px;
    font-size: 24px;
    cursor: pointer;
    color: #666;
}

.preview-image {
    max-width: 100%;
    max-height: 70vh;
    display: block;
    margin: 0 auto;
}

.preview-document {
    width: 100%;
    height: 70vh;
    border: none;
}

.file-icon {
    width: 40px;
    height: 40px;
    margin: 0 auto 10px;
}

#nameCell {
    font-size: 18px; 
    font-weight: 900; /* Larger font for displayed name */
    text-align: center;  /* Center the content */
    padding: 10px;  /* Add some padding */
}

/* Modal title styling */
.modal-content h3 {
    font-size: 24px;  /* Larger font for modal title */
    margin-bottom: 20px;
}

.modalw {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
        }
        .modal-buttons {
            margin-top: 20px;
        }

        .modal-buttons button {
            margin: 0 10px;
            padding: 8px 16px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }

        .modal-buttons button.confirm {
            background-color: #4CAF50;
            color: white;
        }

        .modal-buttons button.cancel {
            background-color: #ff4444;
            color: white;
        }

        /* Toast notification */
        .toast {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background-color: #333;
            color: white;
            padding: 12px 24px;
            border-radius: 4px;
            display: none;
            animation: slideIn 0.3s ease-in-out;
        }

        @keyframes slideIn {
            from {
                transform: translateX(100%);
            }
            to {
                transform: translateX(0);
            }
        }

        .table-containers {
    margin-bottom: 40px;
    border-bottom: 2px solid #ddd;
    padding-bottom: 20px;
}

#duplicateTableBtn:hover {
    background-color: #004494;
}

input[type="file"] {
    display: none;
}
    </style>
</head>
<body>
    <header id="page-topbar">
        <div class="navbar-header">
            <div class="d-flex">
                <!-- LOGO -->
                <div class="navbar-brand-box">
                    <a href="index.html" class="logo logo-dark">
                        <!-- <span class="logo-sm">
                            <img src="assets/images/logo.svg" alt="" height="22">
                        </span>
                        <span class="logo-lg">
                            <img src="assets/images/logo-dark.png" alt="" height="17">
                        </span> -->
                    </a>

                    <!-- <a href="index.html" class="logo logo-light">
                        <span class="logo-sm">
                            <img src="assets/images/logo-light.svg" alt="" height="22">
                        </span>
                        <span class="logo-lg">
                            <img src="assets/images/logo-light.png" alt="" height="19">
                        </span>
                    </a> -->
                </div>

                <button type="button" class="btn btn-sm px-3 font-size-16 header-item waves-effect" id="vertical-menu-btn" 
                >
            <i class="fa fa-fw fa-bars"></i>
                </button>

                

                <div class="dropdown dropdown-mega d-none d-lg-block ms-2">
                    <!-- <button type="button" class="btn header-item waves-effect" data-bs-toggle="dropdown" aria-haspopup="false" aria-expanded="false">
                        <span key="t-megamenu">Mega Menu</span>
                        <i class="mdi mdi-chevron-down"></i> 
                    </button> -->
                    <div class="dropdown-menu dropdown-megamenu">
                        <div class="row">
                            <div class="col-sm-8">

                                <div class="row">
                                    <div class="col-md-4">
                                        <h5 class="font-size-14" key="t-ui-components">UI Components</h5>
                                        <ul class="list-unstyled megamenu-list">
                                            <li>
                                                <a href="javascript:void(0);" key="t-lightbox">Lightbox</a>
                                            </li>
                                            <li>
                                                <a href="javascript:void(0);" key="t-range-slider">Range Slider</a>
                                            </li>
                                            <li>
                                                <a href="javascript:void(0);" key="t-sweet-alert">Sweet Alert</a>
                                            </li>
                                            <li>
                                                <a href="javascript:void(0);" key="t-rating">Rating</a>
                                            </li>
                                            <li>
                                                <a href="javascript:void(0);" key="t-forms">Forms</a>
                                            </li>
                                            <li>
                                                <a href="javascript:void(0);" key="t-tables">Tables</a>
                                            </li>
                                            <li>
                                                <a href="javascript:void(0);" key="t-charts">Charts</a>
                                            </li>
                                        </ul>
                                    </div>

                                    <div class="col-md-4">
                                        <h5 class="font-size-14" key="t-applications">Applications</h5>
                                        <ul class="list-unstyled megamenu-list">
                                            <li>
                                                <a href="javascript:void(0);" key="t-ecommerce">Ecommerce</a>
                                            </li>
                                            <li>
                                                <a href="javascript:void(0);" key="t-calendar">Calendar</a>
                                            </li>
                                            <li>
                                                <a href="javascript:void(0);" key="t-email">Email</a>
                                            </li>
                                            <li>
                                                <a href="javascript:void(0);" key="t-projects">Projects</a>
                                            </li>
                                            <li>
                                                <a href="javascript:void(0);" key="t-tasks">Tasks</a>
                                            </li>
                                            <li>
                                                <a href="javascript:void(0);" key="t-contacts">Contacts</a>
                                            </li>
                                        </ul>
                                    </div>

                                    <div class="col-md-4">
                                        <h5 class="font-size-14" key="t-extra-pages">Extra Pages</h5>
                                        <ul class="list-unstyled megamenu-list">
                                            <li>
                                                <a href="javascript:void(0);" key="t-light-sidebar">Light Sidebar</a>
                                            </li>
                                            <li>
                                                <a href="javascript:void(0);" key="t-compact-sidebar">Compact Sidebar</a>
                                            </li>
                                            <li>
                                                <a href="javascript:void(0);" key="t-horizontal">Horizontal layout</a>
                                            </li>
                                            <li>
                                                <a href="javascript:void(0);" key="t-maintenance">Maintenance</a>
                                            </li>
                                            <li>
                                                <a href="javascript:void(0);" key="t-coming-soon">Coming Soon</a>
                                            </li>
                                            <li>
                                                <a href="javascript:void(0);" key="t-timeline">Timeline</a>
                                            </li>
                                            <li>
                                                <a href="javascript:void(0);" key="t-faqs">FAQs</a>
                                            </li>
                    
                                        </ul>
                                    </div>
                                </div>
                            </div>
                            <div class="col-sm-4">
                                <div class="row">
                                    <div class="col-sm-6">
                                        <h5 class="font-size-14" key="t-ui-components">UI Components</h5>
                                        <ul class="list-unstyled megamenu-list">
                                            <li>
                                                <a href="javascript:void(0);" key="t-lightbox">Lightbox</a>
                                            </li>
                                            <li>
                                                <a href="javascript:void(0);" key="t-range-slider">Range Slider</a>
                                            </li>
                                            <li>
                                                <a href="javascript:void(0);" key="t-sweet-alert">Sweet Alert</a>
                                            </li>
                                            <li>
                                                <a href="javascript:void(0);" key="t-rating">Rating</a>
                                            </li>
                                            <li>
                                                <a href="javascript:void(0);" key="t-forms">Forms</a>
                                            </li>
                                            <li>
                                                <a href="javascript:void(0);" key="t-tables">Tables</a>
                                            </li>
                                            <li>
                                                <a href="javascript:void(0);" key="t-charts">Charts</a>
                                            </li>
                                        </ul>
                                    </div>

                                    <div class="col-sm-5">
                                        <div>
                                            <img src="assets/images/megamenu-img.png" alt="" class="img-fluid mx-auto d-block">
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                    </div>
                </div>
            </div>

            <div class="d-flex">

                <div class="dropdown d-inline-block d-lg-none ms-2">
                    <button type="button" class="btn header-item noti-icon waves-effect" id="page-header-search-dropdown"
                    data-bs-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                        <i class="mdi mdi-magnify"></i>
                    </button>
                    <div class="dropdown-menu dropdown-menu-lg dropdown-menu-end p-0"
                        aria-labelledby="page-header-search-dropdown">

                        <form class="p-3">
                            <div class="form-group m-0">
                                <div class="input-group">
                                    <input type="text" class="form-control" placeholder="Search ..." aria-label="Recipient's username">
                                    <div class="input-group-append">
                                        <button class="btn btn-primary" type="submit"><i class="mdi mdi-magnify"></i></button>
                                    </div>
                                </div>
                            </div>
                        </form>
                    </div>
                </div>

                <div class="dropdown d-inline-block">
                    <button type="button" class="btn header-item waves-effect"
                    data-bs-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                        <img id="header-lang-img" src="assets/images/flags/us.jpg" alt="Header Language" height="16">
                    </button>
                    <div class="dropdown-menu dropdown-menu-end">

                        <!-- item-->
                        <a href="javascript:void(0);" class="dropdown-item notify-item language" data-lang="en">
                            <img src="assets/images/flags/us.jpg" alt="user-image" class="me-1" height="12"> <span class="align-middle">English</span>
                        </a>
                        <!-- item-->
                        <a href="javascript:void(0);" class="dropdown-item notify-item language" data-lang="sp">
                            <img src="assets/images/flags/spain.jpg" alt="user-image" class="me-1" height="12"> <span class="align-middle">Spanish</span>
                        </a>

                        <!-- item-->
                        <a href="javascript:void(0);" class="dropdown-item notify-item language" data-lang="gr">
                            <img src="assets/images/flags/germany.jpg" alt="user-image" class="me-1" height="12"> <span class="align-middle">German</span>
                        </a>

                        <!-- item-->
                        <a href="javascript:void(0);" class="dropdown-item notify-item language" data-lang="it">
                            <img src="assets/images/flags/italy.jpg" alt="user-image" class="me-1" height="12"> <span class="align-middle">Italian</span>
                        </a>

                        <!-- item-->
                        <a href="javascript:void(0);" class="dropdown-item notify-item language" data-lang="ru">
                            <img src="assets/images/flags/russia.jpg" alt="user-image" class="me-1" height="12"> <span class="align-middle">Russian</span>
                        </a>
                    </div>
                </div>

                <div class="dropdown d-none d-lg-inline-block ms-1">
                    <button type="button" class="btn header-item noti-icon waves-effect"
                    data-bs-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                        <i class="bx bx-customize"></i>
                    </button>
                    <div class="dropdown-menu dropdown-menu-lg dropdown-menu-end">
                        <div class="px-lg-2">
                            <div class="row g-0">
                                <div class="col">
                                    <a class="dropdown-icon-item" href="#">
                                        <img src="assets/images/brands/github.png" alt="Github">
                                        <span>GitHub</span>
                                    </a>
                                </div>
                                <div class="col">
                                    <a class="dropdown-icon-item" href="#">
                                        <img src="assets/images/brands/bitbucket.png" alt="bitbucket">
                                        <span>Bitbucket</span>
                                    </a>
                                </div>
                                <div class="col">
                                    <a class="dropdown-icon-item" href="#">
                                        <img src="assets/images/brands/dribbble.png" alt="dribbble">
                                        <span>Dribbble</span>
                                    </a>
                                </div>
                            </div>

                            <div class="row g-0">
                                <div class="col">
                                    <a class="dropdown-icon-item" href="#">
                                        <img src="assets/images/brands/dropbox.png" alt="dropbox">
                                        <span>Dropbox</span>
                                    </a>
                                </div>
                                <div class="col">
                                    <a class="dropdown-icon-item" href="#">
                                        <img src="assets/images/brands/mail_chimp.png" alt="mail_chimp">
                                        <span>Mail Chimp</span>
                                    </a>
                                </div>
                                <div class="col">
                                    <a class="dropdown-icon-item" href="#">
                                        <img src="assets/images/brands/slack.png" alt="slack">
                                        <span>Slack</span>
                                    </a>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="dropdown d-none d-lg-inline-block ms-1">
                    <button type="button" class="btn header-item noti-icon waves-effect" data-bs-toggle="fullscreen">
                        <i class="bx bx-fullscreen"></i>
                    </button>
                </div>

                <div class="dropdown d-inline-block">
                    <button type="button" class="btn header-item noti-icon waves-effect" id="page-header-notifications-dropdown"
                    data-bs-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                        <i class="bx bx-bell bx-tada"></i>
                        <span class="badge bg-danger rounded-pill">3</span>
                    </button>
                    <div class="dropdown-menu dropdown-menu-lg dropdown-menu-end p-0"
                        aria-labelledby="page-header-notifications-dropdown">
                        <div class="p-3">
                            <div class="row align-items-center">
                                <div class="col">
                                    <h6 class="m-0" key="t-notifications"> Notifications </h6>
                                </div>
                                <div class="col-auto">
                                    <a href="#!" class="small" key="t-view-all"> View All</a>
                                </div>
                            </div>
                        </div>
                        <div data-simplebar style="max-height: 230px;">
                            <a href="javascript: void(0);" class="text-reset notification-item">
                                <div class="d-flex">
                                    <div class="avatar-xs me-3">
                                        <span class="avatar-title bg-primary rounded-circle font-size-16">
                                            <i class="bx bx-cart"></i>
                                        </span>
                                    </div>
                                    <div class="flex-grow-1">
                                        <h6 class="mb-1" key="t-your-order">Your order is placed</h6>
                                        <div class="font-size-12 text-muted">
                                            <p class="mb-1" key="t-grammer">If several languages coalesce the grammar</p>
                                            <p class="mb-0"><i class="mdi mdi-clock-outline"></i> <span key="t-min-ago">3 min ago</span></p>
                                        </div>
                                    </div>
                                </div>
                            </a>
                            <a href="javascript: void(0);" class="text-reset notification-item">
                                <div class="d-flex">
                                    <img src="assets/images/users/avatar-3.jpg"
                                        class="me-3 rounded-circle avatar-xs" alt="user-pic">
                                    <div class="flex-grow-1">
                                        <h6 class="mb-1">James Lemire</h6>
                                        <div class="font-size-12 text-muted">
                                            <p class="mb-1" key="t-simplified">It will seem like simplified English.</p>
                                            <p class="mb-0"><i class="mdi mdi-clock-outline"></i> <span key="t-hours-ago">1 hours ago</span></p>
                                        </div>
                                    </div>
                                </div>
                            </a>
                            <a href="javascript: void(0);" class="text-reset notification-item">
                                <div class="d-flex">
                                    <div class="avatar-xs me-3">
                                        <span class="avatar-title bg-success rounded-circle font-size-16">
                                            <i class="bx bx-badge-check"></i>
                                        </span>
                                    </div>
                                    <div class="flex-grow-1">
                                        <h6 class="mb-1" key="t-shipped">Your item is shipped</h6>
                                        <div class="font-size-12 text-muted">
                                            <p class="mb-1" key="t-grammer">If several languages coalesce the grammar</p>
                                            <p class="mb-0"><i class="mdi mdi-clock-outline"></i> <span key="t-min-ago">3 min ago</span></p>
                                        </div>
                                    </div>
                                </div>
                            </a>

                            <a href="javascript: void(0);" class="text-reset notification-item">
                                <div class="d-flex">
                                    <img src="assets/images/users/avatar-4.jpg"
                                        class="me-3 rounded-circle avatar-xs" alt="user-pic">
                                    <div class="flex-grow-1">
                                        <h6 class="mb-1">Salena Layfield</h6>
                                        <div class="font-size-12 text-muted">
                                            <p class="mb-1" key="t-occidental">As a skeptical Cambridge friend of mine occidental.</p>
                                            <p class="mb-0"><i class="mdi mdi-clock-outline"></i> <span key="t-hours-ago">1 hours ago</span></p>
                                        </div>
                                    </div>
                                </div>
                            </a>
                        </div>
                        <div class="p-2 border-top d-grid">
                            <a class="btn btn-sm btn-link font-size-14 text-center" href="javascript:void(0)">
                                <i class="mdi mdi-arrow-right-circle me-1"></i> <span key="t-view-more">View More..</span> 
                            </a>
                        </div>
                    </div>
                </div>

                <div class="dropdown d-inline-block">
                    <button type="button" class="btn header-item waves-effect" id="page-header-user-dropdown"
                    data-bs-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                        <img class="rounded-circle header-profile-user" src="assets/images/users/avatar-1.jpg"
                            alt="Header Avatar">
                        <span class="d-none d-xl-inline-block ms-1" key="t-henry">Hriday Sarma</span>
                        <i class="mdi mdi-chevron-down d-none d-xl-inline-block"></i>
                    </button>
                    <div class="dropdown-menu dropdown-menu-end">
                        <!-- item-->
                        <a class="dropdown-item" href="#"><i class="bx bx-user font-size-16 align-middle me-1"></i> <span key="t-profile">Profile</span></a>
                        <a class="dropdown-item" href="#"><i class="bx bx-wallet font-size-16 align-middle me-1"></i> <span key="t-my-wallet">My Wallet</span></a>
                        <a class="dropdown-item d-block" href="#"><span class="badge bg-success float-end">11</span><i class="bx bx-wrench font-size-16 align-middle me-1"></i> <span key="t-settings">Settings</span></a>
                        <a class="dropdown-item" href="#"><i class="bx bx-lock-open font-size-16 align-middle me-1"></i> <span key="t-lock-screen">Lock screen</span></a>
                        <div class="dropdown-divider"></div>
                        <a class="dropdown-item text-danger" href="#"><i class="bx bx-power-off font-size-16 align-middle me-1 text-danger"></i> <span key="t-logout">Logout</span></a>
                    </div>
                </div>

                <!-- <div class="dropdown d-inline-block">
                    <button type="button" class="btn header-item noti-icon right-bar-toggle waves-effect">
                        <i class="bx bx-cog bx-spin"></i>
                    </button>
                </div> -->

            </div>
        </div>
    </header>

    <div class="vertical-menu color-sidebar">
        <div data-simplebar class="h-200">
            <div id="sidebar-menu" style="background-color: #2a3042;">
                <ul class="metismenu list-unstyled" id="side-menu">
                    <li class="menu-title" key="t-menu">Menu</li>
                    <li>
                        <li><a href="index.html" style="color: white; display: block;
                            font-size: 14px;
                            font-weight: 500;
                            transition: all 0.3s ease;
                            text-decoration: none;">Dashboard</a></li>
                    </li>
                    <li class="menu-title" key="t-apps">Apps</li>
                    <li>
                        <a href="search.html">
                            <span key="t-dashboards" class="text-style">Vendor Search</span>
                        </a>
                        <a href="chat.html">
                            <span key="t-dashboards" class="text-style">Discussion</span>
                        </a>
                        <a href="business-operation.html">
                            <span key="t-dashboards" class="text-style">Business Operation</span>
                        </a>
                    </li>
                </ul>
            </div>
        </div>
    </div>


    <!-- ---------------------------------CONTENT----------------------------------------- -->


    <!-- <button id="duplicateTableBtn" class="manage-btn" style="
    position: fixed;
    top: 80px;
    right: 20px;
    z-index: 1000;
    background-color: #0056b3;
    color: white;
    padding: 10px 20px;
    border: none;
    border-radius: 4px;
    cursor: pointer;">
    Duplicate Table
</button> -->

<div id="table-containers">

<div class="table-container" style="
margin-top: 80px; 
margin-left: 250px;
padding: 20px;
width: calc(100% - 250px);
position: relative;
min-height: calc(100vh - 80px);
background-color: #f8f9fa;
overflow-x: auto;
">       <table id="agreementTable">
            <thead>
                <tr>
                    <th style="text-align: center;">Initial Discussion</th>
                    <th style="text-align: center;">Sub Agreement</th>
                    <th style="text-align: center;">Product / Service Specification</th>
                    <th id="dynamic-columns-start"></th>
                    <th style="text-align: center;">Deal Completed</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td class="table-cell">
                        <div id="discussionContainer" class="discussion-container">
                            <button id="addDiscussionBtn" class="manage-btn" style="margin-top: 5px;" onclick="openModal()">Add Discussion</button>
                            <div id="selectedNamesDisplay" class="selected-names-display" style="display: none">
                                <span id="displayedNames"></span>
                                <button class="edit-btn" onclick="openModal()">Edit</button>
                            </div>
                        </div>
                    </td>
                    
                    <td>
                        <div class="checkbox-container" style="display: flex; flex-direction: column; align-items: center;">
                            <div class="containers" style="display: flex; justify-content: center; margin-bottom: 5px; gap: 8px;">
                                <div class="checkbox" onclick="handleCheckboxClick(this)"></div>
                                <div class="checkbox" onclick="handleCheckboxClick(this)"></div>
                            </div>
                            <input type="file" id="fileInput" accept="image/*,.pdf,.doc,.docx" onchange="handleFileUpload(this)">
                            <label for="fileInput" class="upload-btn">Upload File</label>
                            <div class="file-preview" onclick="showPreview(this)">
                                <img class="file-icon" src="" alt="File icon">
                                <div class="file-name"></div>
                            </div>
                        </div>
                    </td>
                    <td id="nameCell">
                        <button id="addDiscussionBtn" class="manage-btn containers" style="margin-left:10px; margin-top: 25px;" onclick="openModals()">Add Name</button>
                    </td>
                    <td>
                        <button class="add-column-btn manage-btn" style="margin-left: 40px; font-size: 15px; background-color: #0056b3; color: white;" onclick="showAddColumnModal()">Add column</button>
                    </td>
                    <td>
                        <div class="checkbox-container" style="display: flex; justify-content: center; align-items: center;">
                            <div class="checkbox" onclick="handleCheckboxClick(this)"></div>
                            <div class="checkbox" onclick="handleCheckboxClick(this)"></div>
                        </div>
                    </td>
                </tr>
            </tbody>
        </table>
    </div>
    </div>

    <!-- Modal for adding new column -->
    <div id="columnModal" class="modal">
        <div class="modal-content">
            <h2 style="font-size: 18px;">Add New Column</h2>
            <input type="text" id="columnName" placeholder="Enter column name">
            <div class="modal-buttons">
                <button class="save-btn" onclick="addNewColumn()">Save</button>
            </div>
        </div>
    </div>

    <div id="searchModal" class="modal">
        <div class="modal-contents" style="margin-top: 20px;">
            <div class="modal-header">
                <h2 class="modal-title">Select Contacts</h2>
                <div class="modal-footer">
                    <button class="save-btn" style="margin-top: -40px;" onclick="saveContacts()">Save</button>
                </div>
                <button class="close" onclick="closeModal()">&times;</button>
            </div>
            <div class="selected-contacts" id="selectedContacts"></div>
            <div class="search-container">
                <input type="text" class="search-input" placeholder="Search contacts..." oninput="filterContacts(this.value)">
            </div>
            <div class="contacts-container" id="contactsList"></div>
        </div>
    </div>

    <!-- Modal for adding parties -->
    <div id="partyModal" class="modal">
        <div class="modal-content">
            <h2>Add Party</h2>
            <input type="text" id="partyName" placeholder="Enter party name">
            <div class="modal-buttons">
                <button class="cancel-btn" onclick="closePartyModal()">Cancel</button>
                <button class="save-btn" onclick="saveParty()">Save</button>
            </div>
        </div>
    </div>

    <div id="contentModal" class="modals">submit-btn
        <div class="modal-contents">
            <h2>Add Content</h2>
            <textarea id="contentInput" placeholder="Enter your content here..." rows="4"></textarea>
            <div class="modal-buttons">
                <button class="cancel-btn" onclick="closeContentModal()">Cancel</button>
                <button class="save-btn" onclick="saveContent()">Save</button>
            </div>
        </div>
    </div>
    
    <div id="viewContentModal" class="modal">
        <div class="modal-content">
            <span class="closes" onclick="closeViewContentModal()">&times;</span>
            <h2>Full Content</h2>
            <div id="fullContentDisplay"></div>
        </div>
    </div>

    <div id="previewModal" class="preview-modal">
        <div class="preview-content">
            <span class="close-preview" onclick="closePreview()">&times;</span>
            <img class="preview-image" src="" alt="Preview" style="display: none;">
            <iframe class="preview-document" src="" style="display: none;"></iframe>
        </div>
    </div>

    <div id="nameModal" class="modal">
        <div class="modal-content">
            <span class="close" style="margin-top: 10px;" onclick="closeModals()">&times;</span>
            <h3>Add Name</h3>
            <input type="text" id="nameInput" class="name-inputss" placeholder="Enter name">
            <button onclick="addNames()" style="margin-top: 20px;" class="manage-btn">Submit</button>
        </div>
    </div>
    
    <div class="modalw" id="confirmModal">
        <div class="modal-content">
            <h3>Confirmation</h3>
            <p>Are you sure you want to confirm?</p>
            <div class="modal-buttons">
                <button class="confirm" onclick="handleConfirm()">Yes</button>
                <button class="cancel" onclick="closeModalw()">No</button>
            </div>
        </div>
    </div>

    <div class="toast" id="toast">
        Not allowed
    </div>

    <script>
let activeCheckbox = null;
        const modalw = document.getElementById('confirmModal');
        const toast = document.getElementById('toast');

        function handleCheckboxClick(element) {
            if (element.classList.contains('checked')) {
                showToast();
                return;
            }
            
            activeCheckbox = element;
            showModal();
        }

        function showModal() {
            modalw.style.display = 'block';
        }

        function closeModalw() {
            modalw.style.display = 'none';
            activeCheckbox = null;
        }

        function handleConfirm() {
            if (activeCheckbox) {
                activeCheckbox.classList.add('checked');
                closeModalw();
            }
        }

        function showToast() {
            toast.style.display = 'block';
            setTimeout(() => {
                toast.style.display = 'none';
            }, 3000);
        }








const modal = document.getElementById('nameModal');
const nameCell = document.getElementById('nameCell');

function openModals() {
    modal.style.display = "block";
    document.getElementById('nameInput').value = '';
}

function closeModals() {
    modal.style.display = "none";
}

function addNames() {
    const name = document.getElementById('nameInput').value.trim();
    if (name) {
        // Replace button with the entered name
        nameCell.innerHTML = name;
        closeModals();
    } else {
        alert('Please enter a name');
    }
}

// Close modal when clicking outside
window.onclick = function(event) {
    if (event.target == modal) {
        closeModals();
    }
}

// Handle Enter key press
document.getElementById('nameInput').addEventListener('keypress', function(e) {
    if (e.key === 'Enter') {
        addNames();
    }
});






      function toggleCheckbox(element) {
    element.classList.toggle('checked');
}

function showAddColumnModal() {
    const modal = document.getElementById('columnModal');
    modal.style.display = 'block';
}

function closeModalq() {
    document.getElementById('columnModal').style.display = 'none';
    document.getElementById('columnName').value = '';
}

function addNewColumn() {
    const name = document.getElementById('columnName').value;
    if (name.trim() === '') return;

    const table = document.getElementById('agreementTable');
    const headerRow = table.querySelector('thead tr');
    const dataRow = table.querySelector('tbody tr');
    
    // Create new header with the entered name
    const newHeader = document.createElement('th');showPreview
    newHeader.textContent = name;
    newHeader.style.textAlign = 'center';
    
    const newCell = document.createElement('td');
    newCell.innerHTML = `
        <div class="checkbox-container" style="display: flex; flex-direction: column; align-items: center;">
            <div style="display: flex; justify-content: center; gap:10px; margin-bottom: 5px;">
             <div class="checkbox" onclick="handleCheckboxClick(this)"></div>
                                <div class="checkbox" onclick="handleCheckboxClick(this)"></div>
            </div>
            <input type="file" id="fileInput_${Date.now()}" accept="image/*,.pdf,.doc,.docx" onchange="handleFileUpload(this)">
            <label for="fileInput_${Date.now()}" class="upload-btn">Upload File</label>
            <div class="file-preview" onclick="showPreview(this)">
                <img class="file-icon" src="" alt="File icon">
                <div class="file-name"></div>
            </div>
        </div>
    `;

    // Insert before the + button column
    const addButtonColumn = headerRow.querySelector('th:last-child');
    headerRow.insertBefore(newHeader, addButtonColumn);
    dataRow.insertBefore(newCell, dataRow.querySelector('td:last-child'));

    closeModalq();
    document.getElementById('columnName').value = '';
}

function handleFileUpload(input) {
    const file = input.files[0];
    if (!file) return;

    const container = input.parentElement;
    const uploadBtn = container.querySelector('.upload-btn');
    const preview = container.querySelector('.file-preview');
    const fileIcon = preview.querySelector('.file-icon');
    const fileName = preview.querySelector('.file-name');

    // Store file data for preview
    preview.dataset.fileType = file.type;
    preview.dataset.fileUrl = URL.createObjectURL(file);

    // Set appropriate icon based on file type
    if (file.type.startsWith('image/')) {
        fileIcon.src = 'data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIyNCIgaGVpZ2h0PSIyNCIgdmlld0JveD0iMCAwIDI0IDI0IiBmaWxsPSJub25lIiBzdHJva2U9ImN1cnJlbnRDb2xvciIgc3Ryb2tlLXdpZHRoPSIyIiBzdHJva2UtbGluZWNhcD0icm91bmQiIHN0cm9rZS1saW5lam9pbj0icm91bmQiPjxyZWN0IHg9IjMiIHk9IjMiIHdpZHRoPSIxOCIgaGVpZ2h0PSIxOCIgcng9IjIiIHJ5PSIyIj48L3JlY3Q+PGNpcmNsZSBjeD0iOC41IiBjeT0iOC41IiByPSIxLjUiPjwvY2lyY2xlPjxwb2x5bGluZSBwb2ludHM9IjIxIDE1IDEzIDIxIDMgMTUiPjwvcG9seWxpbmU+PC9zdmc+';
    } else {
        fileIcon.src = 'data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIyNCIgaGVpZ2h0PSIyNCIgdmlld0JveD0iMCAwIDI0IDI0IiBmaWxsPSJub25lIiBzdHJva2U9ImN1cnJlbnRDb2xvciIgc3Ryb2tlLXdpZHRoPSIyIiBzdHJva2UtbGluZWNhcD0icm91bmQiIHN0cm9rZS1saW5lam9pbj0icm91bmQiPjxwYXRoIGQ9Ik0xMyAySDZhMiAyIDAgMCAwLTIgMnYxNmEyIDIgMCAwIDAgMiAyaDEyYTIgMiAwIDAgMCAyLTJWOXoiPjwvcGF0aD48cG9seWxpbmUgcG9pbnRzPSIxMyAyIDEzIDkgMjAgOSI+PC9wb2x5bGluZT48L3N2Zz4=';
    }

    fileName.textContent = file.name;
    uploadBtn.style.display = 'none';
    preview.style.display = 'block';
}

function showPreview(previewElement) {
    const modal = document.getElementById('previewModal');
    const previewImage = modal.querySelector('.preview-image');
    const previewDocument = modal.querySelector('.preview-document');
    
    const fileType = previewElement.dataset.fileType;
    const fileUrl = previewElement.dataset.fileUrl;

    if (fileType.startsWith('image/')) {
        previewImage.src = fileUrl;
        previewImage.style.display = 'block';
        previewDocument.style.display = 'none';
    } else {
        previewDocument.src = fileUrl;
        previewDocument.style.display = 'block';
        previewImage.style.display = 'none';
    }

    modal.style.display = 'block';
}

function closePreview() {
    const modal = document.getElementById('previewModal');
    modal.style.display = 'none';
}

// Close modal when clicking outside
window.onclick = function(event) {
    const modal = document.getElementById('previewModal');
    if (event.target === modal) {
        closePreview();
    }
}

function closeModal() {
    document.getElementById('columnModal').style.display = 'none';
}

let currentCell = null;

function showContentModal(button) {
    currentCell = button.parentElement;
    document.getElementById('contentModal').style.display = 'block';
    document.getElementById('contentInput').value = '';
}

function closeContentModal() {
    document.getElementById('contentModal').style.display = 'none';
    currentCell = null;
}

function saveContent() {
    if (!currentCell) return;
    
    const content = document.getElementById('contentInput').value.trim();
    if (content === '') return;

    const contentCell = currentCell.querySelector('.content-cell');
    contentCell.textContent = content;
    contentCell.style.display = 'block';
    contentCell.setAttribute('data-full-content', content);
    
    closeContentModal();
}

function showViewContentModal(contentCell) {
    const fullContent = contentCell.getAttribute('data-full-content');
    document.getElementById('fullContentDisplay').textContent = fullContent;
    document.getElementById('viewContentModal').style.display = 'block';
}

function closeViewContentModal() {
    document.getElementById('viewContentModal').style.display = 'none';
}

// Close modals when clicking outside
window.onclick = function(event) {
    const modals = [
        document.getElementById('columnModal'),
        document.getElementById('contentModal'),
        document.getElementById('viewContentModal')
    ];
    
    modals.forEach(modal => {
        if (event.target === modal) {
            modal.style.display = 'none';
        }
    });
}

        function addParty() {
            document.getElementById('partyModal').style.display = 'flex';
        }

        function saveParty() {
            const partyName = document.getElementById('partyName').value;
            if (partyName.trim() === '') return;

            const table = document.getElementById('agreementTable');
            const newRow = document.createElement('tr');
            
            // Clone the first row's structure
            const firstRow = table.querySelector('tbody tr');
            newRow.innerHTML = firstRow.innerHTML;
            
            // Update the first cell with party name
            newRow.firstElementChild.textContent = partyName;
            
            table.querySelector('tbody').appendChild(newRow);
            
            closePartyModal();
            document.getElementById('partyName').value = '';
        }

        const mainModal = document.getElementById('mainModal');
            const termsModal = document.getElementById('termsModal');
            const contents = document.querySelectorAll('.sub-agreement-content');
            const arrows = document.querySelectorAll('.arrow');

          // Store selected contacts for each row
const rowContacts = new Map();
let rowCounter = 0;

const contacts = [
    { name: 'Alice Johnson', role: 'Product Manager' },
    { name: 'Bob Smith', role: 'Senior Developer' },
    { name: 'Carol Williams', role: 'UX Designer' },
    { name: 'David Brown', role: 'Marketing Director' },
    { name: 'Emma Davis', role: 'Project Lead' },
    { name: 'Frank Miller', role: 'Business Analyst' },
    { name: 'Grace Lee', role: 'Software Engineer' },
    { name: 'Henry Wilson', role: 'Quality Assurance' },
    { name: 'Ivy Chen', role: 'Data Scientist' },
    { name: 'Jack Taylor', role: 'Systems Architect' }
];

let currentEditingRow = null;

document.addEventListener('DOMContentLoaded', function() {
    rowContacts.set(0, new Set());
    
    // Get the original button HTML and selected names display HTML
    const originalButtonHtml = document.getElementById('addDiscussionBtn')?.outerHTML || '';
    const originalDisplayHtml = document.getElementById('selectedNamesDisplay')?.outerHTML || '';
    
    // Update the first row's HTML to match the structure we use for new rows
    const firstRowDiscussionCell = document.querySelector('.table-cell');
    if (firstRowDiscussionCell) {
        firstRowDiscussionCell.innerHTML = `
            <div id="discussionContainer-0" class="discussion-container">
                <button id="addDiscussionBtn-0" class="manage-btn" style="margin-top: 5px;" onclick="openModal(0)">Add Discussion</button>
                <div id="selectedNamesDisplay-0" class="selected-names-display" style="display: none">
                    <span id="displayedNames-0"></span>
                    <button class="edit-btn" onclick="openModal(0)">Edit</button>
                </div>
            </div>
        `;
    }
    
    rowCounter = 1;
});

function addNewRow() {
    const tbody = document.getElementById('tableBody');
    const newRow = document.createElement('tr');
    
    // Create a unique identifier for this row
    const rowId = `row-${Date.now()}`;
    
    // Create discussion cell with unique identifiers
    const discussionCell = document.createElement('td');
    discussionCell.className = 'table-cell';
    discussionCell.innerHTML = `
        <div id="discussionContainer-${rowId}" class="discussion-container">
            <button id="addDiscussionBtn-${rowId}" class="manage-btn" style="margin-top: 5px;" onclick="openModal('${rowId}')">Add Discussion</button>
            <div id="selectedNamesDisplay-${rowId}" class="selected-names-display" style="display: none">
                <span id="displayedNames-${rowId}"></span>
                <button class="edit-btn" onclick="openModal('${rowId}')">Edit</button>
            </div>
        </div>
    `;
    newRow.appendChild(discussionCell);
    
    // Create cells for sub-agreements with unique management buttons
    for (let i = 0; i < 11; i++) {
        const td = document.createElement('td');
        td.innerHTML = `
            <div class="cell-content">
                <button class="manage-btn" onclick="openMainModal('${rowId}')">Manage sub agreements</button>
                <div class="duplicate-row-btn-container">
                    <button class="duplicate-row-btn" onclick="duplicateRow(this)">Duplicate Row</button>
                </div>
            </div>
        `;
        newRow.appendChild(td);
    }
    
    // Append the new row
    tbody.appendChild(newRow);
    
    // Update contacts map with a new Set for this unique row
    rowContacts.set(rowId, new Set());
}

function duplicateRow(buttonElement) {
    // Find the parent row
    const originalRow = buttonElement.closest('tr');
    const tbody = originalRow.closest('tbody');
    
    // Create a new row
    const newRow = originalRow.cloneNode(true);
    
    // Generate new unique IDs for all elements in the new row
    const newRowId = `row-${Date.now()}`;
    
    // Update discussion container IDs
    const discussionContainer = newRow.querySelector('.discussion-container');
    discussionContainer.id = `discussionContainer-${newRowId}`;
    
    // Update discussion button
    const addDiscussionBtn = newRow.querySelector('[id^="addDiscussionBtn-"]');
    addDiscussionBtn.id = `addDiscussionBtn-${newRowId}`;
    addDiscussionBtn.setAttribute('onclick', `openModal('${newRowId}')`);
    
    // Update selected names display
    const selectedNamesDisplay = newRow.querySelector('[id^="selectedNamesDisplay-"]');
    selectedNamesDisplay.id = `selectedNamesDisplay-${newRowId}`;
    
    // Update displayed names
    const displayedNames = newRow.querySelector('[id^="displayedNames-"]');
    displayedNames.id = `displayedNames-${newRowId}`;
    
    // Update edit button
    const editBtn = selectedNamesDisplay.querySelector('.edit-btn');
    editBtn.setAttribute('onclick', `openModal('${newRowId}')`);
    
    // Update sub-agreement manage buttons
    const manageButtons = newRow.querySelectorAll('.manage-btn');
    manageButtons.forEach(btn => {
        btn.setAttribute('onclick', `openMainModal('${newRowId}')`);
    });
    
    // Reset discussion button and names display
    addDiscussionBtn.style.display = 'block';
    selectedNamesDisplay.style.display = 'none';
    displayedNames.textContent = '';
    
    // Insert the new row after the original row
    tbody.insertBefore(newRow, originalRow.nextSibling);
    
    // Create a new entry in rowContacts for the new row
    rowContacts.set(newRowId, new Set());
}

function openModal(rowId) {
    currentEditingRow = rowId;
    const modal = document.getElementById('searchModal');
    modal.style.display = 'block';
    
    // Clear and initialize the selected contacts display
    const selectedContactsDiv = document.getElementById('selectedContacts');
    selectedContactsDiv.innerHTML = '';
    
    // Pre-populate selected contacts if any exist for this row
    if (rowContacts.has(rowId)) {
        const selectedContacts = rowContacts.get(rowId);
        if (selectedContacts.size > 0) {
            renderSelectedContacts();
        }
    }
    
    renderContacts(contacts);
}

function closeModal() {
    document.getElementById('searchModal').style.display = 'none';
    currentEditingRow = null;
}

function getInitials(name) {
    return name.split(' ').map(word => word[0]).join('');
}

function renderContacts(contactsToRender) {
    const contactsList = document.getElementById('contactsList');
    contactsList.innerHTML = contactsToRender.map(contact => `
        <div class="contact-card ${isContactSelected(contact) ? 'selected' : ''}" 
             onclick="toggleContact('${contact.name}', '${contact.role}')">
            <div class="avatar">${getInitials(contact.name)}</div>
            <div class="contact-info">
                <div class="contact-name">${contact.name}</div>
                <div class="contact-role">${contact.role}</div>
            </div>
        </div>
    `).join('');
}

function isContactSelected(contact) {
    if (currentEditingRow === null || !rowContacts.has(currentEditingRow)) return false;
    return Array.from(rowContacts.get(currentEditingRow))
        .some(c => c.name === contact.name);
}

function renderSelectedContacts() {
    const selectedContactsDiv = document.getElementById('selectedContacts');
    if (currentEditingRow === null || !rowContacts.has(currentEditingRow)) return;

    const selectedContacts = rowContacts.get(currentEditingRow);
    selectedContactsDiv.innerHTML = Array.from(selectedContacts).map(contact => `
        <div class="selected-contact">
            <div class="avatar">${getInitials(contact.name)}</div>
            ${contact.name}
            <span class="remove-contact" onclick="removeContact('${contact.name}', '${contact.role}', event)">×</span>
        </div>
    `).join('');

    // Show selected contacts in the modal header
    selectedContactsDiv.style.display = selectedContacts.size > 0 ? 'flex' : 'none';
}

function toggleContact(name, role) {
    if (currentEditingRow === null) return;
    
    const contact = { name, role };
    const rowSelectedContacts = rowContacts.get(currentEditingRow) || new Set();
    
    if (Array.from(rowSelectedContacts).some(c => c.name === name)) {
        rowSelectedContacts.delete(Array.from(rowSelectedContacts).find(c => c.name === name));
    } else {
        rowSelectedContacts.add(contact);
    }
    
    rowContacts.set(currentEditingRow, rowSelectedContacts);
    renderSelectedContacts();
    renderContacts(contacts);
}

function removeContact(name, role, event) {
    event.stopPropagation();
    if (currentEditingRow === null) return;
    
    const rowSelectedContacts = rowContacts.get(currentEditingRow);
    const contact = Array.from(rowSelectedContacts).find(c => c.name === name);
    if (contact) {
        rowSelectedContacts.delete(contact);
        renderSelectedContacts();
        renderContacts(contacts);
    }
}

function filterContacts(searchTerm) {
    const filtered = contacts.filter(contact => 
        contact.name.toLowerCase().includes(searchTerm.toLowerCase()) ||
        contact.role.toLowerCase().includes(searchTerm.toLowerCase())
    );
    renderContacts(filtered);
}

function saveContacts() {
    if (currentEditingRow === null) return;
    
    const addDiscussionBtn = document.getElementById(`addDiscussionBtn-${currentEditingRow}`);
    const selectedNamesDisplay = document.getElementById(`selectedNamesDisplay-${currentEditingRow}`);
    const displayedNames = document.getElementById(`displayedNames-${currentEditingRow}`);
    
    const selectedContacts = rowContacts.get(currentEditingRow);
    const names = Array.from(selectedContacts).map(contact => contact.name);

    if (names.length > 0) {
        displayedNames.textContent = names.join(' & ');
        addDiscussionBtn.style.display = 'none';
        selectedNamesDisplay.style.display = 'block';
    }
    closeModal();
}

window.onclick = function(event) {
    const modal = document.getElementById('searchModal');
    if (event.target === modal) {
        closeModal();
    }
}


const state = {
    completedItems: new Set(),
    currentActiveIndex: 0
};

// Initialize the UI
document.addEventListener('DOMContentLoaded', function() {
    // Lock all items except the first one
    const items = document.querySelectorAll('.sub-agreement-item');
    items.forEach((item, index) => {
        if (index > 0) {
            item.classList.add('locked');
        }
    });
});

function toggleContent(index) {
    // Only allow toggling if the item is not locked
    const items = document.querySelectorAll('.sub-agreement-item');
    const item = items[index];
    
    if (!item.classList.contains('locked')) {
        const content = item.querySelector('.sub-agreement-content');
        const arrow = item.querySelector('.arrow');
        
        content.classList.toggle('active');
        arrow.classList.toggle('active');
    }
}


// Optional: Add a visual feedback when trying to interact with locked items
document.querySelectorAll('.sub-agreement-item').forEach((item, index) => {
    item.addEventListener('click', (event) => {
        if (item.classList.contains('locked')) {
            item.style.animation = 'shake 0.5s ease-in-out';
            setTimeout(() => {
                item.style.animation = '';
            }, 500);
        }
    });
});

// Add this CSS animation to your stylesheet
const style = document.createElement('style');
style.textContent = `
    @keyframes shake {
        0%, 100% { transform: translateX(0); }
        25% { transform: translateX(-5px); }
        75% { transform: translateX(5px); }
    }
`;
document.head.appendChild(style);

function closeMainModal() {
    document.getElementById('mainModal').style.display = 'none';
}

        let selectedCompany1 = '';
        let selectedCompany2 = '';

        function openDiscussionModal() {
            document.getElementById('discussionModal').style.display = 'block';
        }

        function closeDiscussionModal() {
            document.getElementById('discussionModal').style.display = 'none';
        }

        function selectCompany1(element, companyName) {
            document.querySelectorAll('.company-column:first-child .company-option').forEach(opt => {
                opt.classList.remove('selected');
            });
            element.classList.add('selected');
            selectedCompany1 = companyName;
        }

        function selectCompany2(element, companyName) {
            document.querySelectorAll('.company-column:last-child .company-option').forEach(opt => {
                opt.classList.remove('selected');
            });
            element.classList.add('selected');
            selectedCompany2 = companyName;
        }

        function addCompanies() {
            if (selectedCompany1 && selectedCompany2) {
                const displayDiv = document.getElementById('companiesDisplay');
                const discussionCell = displayDiv.closest('.discussion-cell');
                discussionCell.setAttribute('data-has-companies', 'true');
                displayDiv.innerHTML = `Company 1: ${selectedCompany1} & Company 2: ${selectedCompany2}`;
                closeDiscussionModal();
            }
        }

        function toggleContent(index) {
                contents[index].classList.toggle('active');
                arrows[index].classList.toggle('active');
            }

            function openMainModal() {
                mainModal.style.display = 'block';
            }

            function closeMainModal() {
                mainModal.style.display = 'none';
            }

            function openTermsModal() {
                termsModal.style.display = 'block';
            }

            function closeTermsModal() {
                termsModal.style.display = 'none';
            }


            window.onclick = function(event) {
                if (event.target == mainModal) {
                    closeMainModal();
                }
                if (event.target == termsModal) {
                    closeTermsModal();
                }
            }
            
        window.onclick = function(event) {
            if (event.target == document.getElementById('discussionModal')) {
                closeDiscussionModal();
            }
        }

        // Close modals when clicking outside
        window.onclick = function(event) {
            const columnModal = document.getElementById('columnModal');
            const partyModal = document.getElementById('partyModal');
            if (event.target === columnModal) {
                columnModal.style.display = 'none';
            }
            if (event.target === partyModal) {
                partyModal.style.display = 'none';
            }
        }


// --------------------

// Global variable to track table counter
let globalTableCounter = 1;

// Function to create a unique ID for cloned elements
function generateUniqueId(prefix) {
    return `${prefix}-${Date.now()}-${Math.floor(Math.random() * 1000)}`;
}

// Create "Add Table" button
function createAddTableButton() {
    const button = document.createElement('button');
    button.textContent = 'Add Table';
    button.style.position = 'fixed';
    button.style.left = '270px';
    button.style.top = '80px';
    button.style.zIndex = '1000';
    button.style.padding = '10px';
    button.style.backgroundColor = '#007bff';
    button.style.color = 'white';
    button.style.border = 'none';
    button.style.borderRadius = '5px';
    button.style.cursor = 'pointer';
    button.addEventListener('click', () => cloneCompleteTable());
    document.body.appendChild(button);
}

// Function to deep clone table with fully independent functionality
function cloneCompleteTable() {
    // Clone the entire table-container
    const existingTableContainer = document.querySelector('.table-container');
    const clonedTableContainer = existingTableContainer.cloneNode(true);

    // Create a new wrapper with margin to separate tables
    const wrapper = document.createElement('div');
    wrapper.style.marginTop = '-350px';
    wrapper.appendChild(clonedTableContainer);

    // Insert the new table after the existing tables
    existingTableContainer.parentNode.appendChild(wrapper);

    // Modify IDs and reinitialize the cloned table with independent functionality
    reinitializeClonedTable(clonedTableContainer);
}

// Function to reinitialize the cloned table with independent functionality
function reinitializeClonedTable(clonedTableContainer) {
    globalTableCounter++;
    const currentTableIndex = globalTableCounter;

    // Create a unique contacts map for this specific table
    const tableSpecificContacts = new Map();
    tableSpecificContacts.set(0, new Set());

    // Update table and element IDs
    const table = clonedTableContainer.querySelector('table');
    table.id = `agreementTable-${currentTableIndex}`;

    // Reinitialize discussion container
    const discussionContainer = clonedTableContainer.querySelector('.discussion-container');
    discussionContainer.id = `discussionContainer-${currentTableIndex}`;

    // Update Add Discussion button
    const addDiscussionBtn = discussionContainer.querySelector('.manage-btn');
    addDiscussionBtn.id = `addDiscussionBtn-${currentTableIndex}`;
    
    // Create a closure to capture the specific table's context
    addDiscussionBtn.setAttribute('onclick', `openTableSpecificModal(${currentTableIndex})`);

    // Update selected names display
    const selectedNamesDisplay = discussionContainer.querySelector('.selected-names-display');
    selectedNamesDisplay.id = `selectedNamesDisplay-${currentTableIndex}`;
    
    const displayedNames = selectedNamesDisplay.querySelector('span');
    displayedNames.id = `displayedNames-${currentTableIndex}`;

    // Unique file input handling
    const fileInputs = clonedTableContainer.querySelectorAll('input[type="file"]');
    fileInputs.forEach((input, index) => {
        const uniqueId = `fileInput-${currentTableIndex}-${index}`;
        input.id = uniqueId;
        const label = input.nextElementSibling;
        label.setAttribute('for', uniqueId);

        // Add independent file upload listener
        input.addEventListener('change', function() {
            handleFileUpload(this);
        });
    });

    // Unique checkbox handling
    const checkboxes = clonedTableContainer.querySelectorAll('.checkbox');
    checkboxes.forEach(checkbox => {
        checkbox.addEventListener('click', function() {
            handleCheckboxClick(this);
        });
    });

    // Create a new modal opener specific to this table
    window[`openTableSpecificModal`] = function(tableIndex) {
        // Reset current editing row
        currentEditingRow = 0;
        
        const modal = document.getElementById('searchModal');
        modal.style.display = 'block';

        // Clear and initialize the selected contacts display
        const selectedContactsDiv = document.getElementById('selectedContacts');
        selectedContactsDiv.innerHTML = '';

        // Use the table-specific contacts map
        if (tableSpecificContacts.has(0)) {
            const selectedContacts = tableSpecificContacts.get(0);
            if (selectedContacts.size > 0) {
                renderSelectedContacts();
            }
        }

        renderContacts(contacts);

        // Override save contacts to work with this specific table
        window.saveContacts = function() {
            if (currentEditingRow === null) return;
            
            const addDiscussionBtn = document.getElementById(`addDiscussionBtn-${tableIndex}`);
            const selectedNamesDisplay = document.getElementById(`selectedNamesDisplay-${tableIndex}`);
            const displayedNames = document.getElementById(`displayedNames-${tableIndex}`);
            
            const selectedContacts = tableSpecificContacts.get(currentEditingRow);
            const names = Array.from(selectedContacts).map(contact => contact.name);

            if (names.length > 0) {
                displayedNames.textContent = names.join(' & ');
                addDiscussionBtn.style.display = 'none';
                selectedNamesDisplay.style.display = 'block';
            }
            
            closeModal();
        };

        // Override toggle contact to work with this specific table
        window.toggleContact = function(name, role) {
            if (currentEditingRow === null) return;
            
            const contact = { name, role };
            const rowSelectedContacts = tableSpecificContacts.get(currentEditingRow) || new Set();
            
            if (Array.from(rowSelectedContacts).some(c => c.name === name)) {
                rowSelectedContacts.delete(Array.from(rowSelectedContacts).find(c => c.name === name));
            } else {
                rowSelectedContacts.add(contact);
            }
            
            tableSpecificContacts.set(currentEditingRow, rowSelectedContacts);
            renderSelectedContacts();
            renderContacts(contacts);
        };
    };
}

// Initialize the Add Table button when DOM is loaded
document.addEventListener('DOMContentLoaded', function() {
    createAddTableButton();
});
    </script>
    </div>
</body>
</html>